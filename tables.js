// Tablas estadísticas para distribuciones

// Tabla Z (Normal Estándar) - Valores para áreas en la cola derecha
const zTable = {
    0.90: 1.282,
    0.95: 1.645,
    0.975: 1.960,
    0.99: 2.326,
    0.995: 2.576
};

// Tabla t-Student - gl: grados de libertad, conf: nivel de confianza
const tTable = {
    1: { 0.90: 3.078, 0.95: 6.314, 0.975: 12.706, 0.99: 31.821, 0.995: 63.657 },
    2: { 0.90: 1.886, 0.95: 2.920, 0.975: 4.303, 0.99: 6.965, 0.995: 9.925 },
    3: { 0.90: 1.638, 0.95: 2.353, 0.975: 3.182, 0.99: 4.541, 0.995: 5.841 },
    4: { 0.90: 1.533, 0.95: 2.132, 0.975: 2.776, 0.99: 3.747, 0.995: 4.604 },
    5: { 0.90: 1.476, 0.95: 2.015, 0.975: 2.571, 0.99: 3.365, 0.995: 4.032 },
    6: { 0.90: 1.440, 0.95: 1.943, 0.975: 2.447, 0.99: 3.143, 0.995: 3.707 },
    7: { 0.90: 1.415, 0.95: 1.895, 0.975: 2.365, 0.99: 2.998, 0.995: 3.499 },
    8: { 0.90: 1.397, 0.95: 1.860, 0.975: 2.306, 0.99: 2.896, 0.995: 3.355 },
    9: { 0.90: 1.383, 0.95: 1.833, 0.975: 2.262, 0.99: 2.821, 0.995: 3.250 },
    10: { 0.90: 1.372, 0.95: 1.812, 0.975: 2.228, 0.99: 2.764, 0.995: 3.169 },
    11: { 0.90: 1.363, 0.95: 1.796, 0.975: 2.201, 0.99: 2.718, 0.995: 3.106 },
    12: { 0.90: 1.356, 0.95: 1.782, 0.975: 2.179, 0.99: 2.681, 0.995: 3.055 },
    13: { 0.90: 1.350, 0.95: 1.771, 0.975: 2.160, 0.99: 2.650, 0.995: 3.012 },
    14: { 0.90: 1.345, 0.95: 1.761, 0.975: 2.145, 0.99: 2.624, 0.995: 2.977 },
    15: { 0.90: 1.341, 0.95: 1.753, 0.975: 2.131, 0.99: 2.602, 0.995: 2.947 },
    16: { 0.90: 1.337, 0.95: 1.746, 0.975: 2.120, 0.99: 2.583, 0.995: 2.921 },
    17: { 0.90: 1.333, 0.95: 1.740, 0.975: 2.110, 0.99: 2.567, 0.995: 2.898 },
    18: { 0.90: 1.330, 0.95: 1.734, 0.975: 2.101, 0.99: 2.552, 0.995: 2.878 },
    19: { 0.90: 1.328, 0.95: 1.729, 0.975: 2.093, 0.99: 2.539, 0.995: 2.861 },
    20: { 0.90: 1.325, 0.95: 1.725, 0.975: 2.086, 0.99: 2.528, 0.995: 2.845 },
    21: { 0.90: 1.323, 0.95: 1.721, 0.975: 2.080, 0.99: 2.518, 0.995: 2.831 },
    22: { 0.90: 1.321, 0.95: 1.717, 0.975: 2.074, 0.99: 2.508, 0.995: 2.819 },
    23: { 0.90: 1.319, 0.95: 1.714, 0.975: 2.069, 0.99: 2.500, 0.995: 2.807 },
    24: { 0.90: 1.318, 0.95: 1.711, 0.975: 2.064, 0.99: 2.492, 0.995: 2.797 },
    25: { 0.90: 1.316, 0.95: 1.708, 0.975: 2.060, 0.99: 2.485, 0.995: 2.787 },
    26: { 0.90: 1.315, 0.95: 1.706, 0.975: 2.056, 0.99: 2.479, 0.995: 2.779 },
    27: { 0.90: 1.314, 0.95: 1.703, 0.975: 2.052, 0.99: 2.473, 0.995: 2.771 },
    28: { 0.90: 1.313, 0.95: 1.701, 0.975: 2.048, 0.99: 2.467, 0.995: 2.763 },
    29: { 0.90: 1.311, 0.95: 1.699, 0.975: 2.045, 0.99: 2.462, 0.995: 2.756 },
    30: { 0.90: 1.310, 0.95: 1.697, 0.975: 2.042, 0.99: 2.457, 0.995: 2.750 },
    40: { 0.90: 1.303, 0.95: 1.684, 0.975: 2.021, 0.99: 2.423, 0.995: 2.704 },
    50: { 0.90: 1.299, 0.95: 1.676, 0.975: 2.009, 0.99: 2.403, 0.995: 2.678 },
    60: { 0.90: 1.296, 0.95: 1.671, 0.975: 2.000, 0.99: 2.390, 0.995: 2.660 },
    80: { 0.90: 1.292, 0.95: 1.664, 0.975: 1.990, 0.99: 2.374, 0.995: 2.639 },
    100: { 0.90: 1.290, 0.95: 1.660, 0.975: 1.984, 0.99: 2.364, 0.995: 2.626 },
    120: { 0.90: 1.289, 0.95: 1.658, 0.975: 1.980, 0.99: 2.358, 0.995: 2.617 }
};

// Tabla Chi-Cuadrado - gl: grados de libertad
const chiTable = {
    1: { 0.005: 0.000, 0.01: 0.000, 0.025: 0.001, 0.05: 0.004, 0.95: 3.841, 0.975: 5.024, 0.99: 6.635, 0.995: 7.879 },
    2: { 0.005: 0.010, 0.01: 0.020, 0.025: 0.051, 0.05: 0.103, 0.95: 5.991, 0.975: 7.378, 0.99: 9.210, 0.995: 10.597 },
    3: { 0.005: 0.072, 0.01: 0.115, 0.025: 0.216, 0.05: 0.352, 0.95: 7.815, 0.975: 9.348, 0.99: 11.345, 0.995: 12.838 },
    4: { 0.005: 0.207, 0.01: 0.297, 0.025: 0.484, 0.05: 0.711, 0.95: 9.488, 0.975: 11.143, 0.99: 13.277, 0.995: 14.860 },
    5: { 0.005: 0.412, 0.01: 0.554, 0.025: 0.831, 0.05: 1.145, 0.95: 11.070, 0.975: 12.833, 0.99: 15.086, 0.995: 16.750 },
    6: { 0.005: 0.676, 0.01: 0.872, 0.025: 1.237, 0.05: 1.635, 0.95: 12.592, 0.975: 14.449, 0.99: 16.812, 0.995: 18.548 },
    7: { 0.005: 0.989, 0.01: 1.239, 0.025: 1.690, 0.05: 2.167, 0.95: 14.067, 0.975: 16.013, 0.99: 18.475, 0.995: 20.278 },
    8: { 0.005: 1.344, 0.01: 1.646, 0.025: 2.180, 0.05: 2.733, 0.95: 15.507, 0.975: 17.535, 0.99: 20.090, 0.995: 21.955 },
    9: { 0.005: 1.735, 0.01: 2.088, 0.025: 2.700, 0.05: 3.325, 0.95: 16.919, 0.975: 19.023, 0.99: 21.666, 0.995: 23.589 },
    10: { 0.005: 2.156, 0.01: 2.558, 0.025: 3.247, 0.05: 3.940, 0.95: 18.307, 0.975: 20.483, 0.99: 23.209, 0.995: 25.188 },
    11: { 0.005: 2.603, 0.01: 3.053, 0.025: 3.816, 0.05: 4.575, 0.95: 19.675, 0.975: 21.920, 0.99: 24.725, 0.995: 26.757 },
    12: { 0.005: 3.074, 0.01: 3.571, 0.025: 4.404, 0.05: 5.226, 0.95: 21.026, 0.975: 23.337, 0.99: 26.217, 0.995: 28.300 },
    13: { 0.005: 3.565, 0.01: 4.107, 0.025: 5.009, 0.05: 5.892, 0.95: 22.362, 0.975: 24.736, 0.99: 27.688, 0.995: 29.819 },
    14: { 0.005: 4.075, 0.01: 4.660, 0.025: 5.629, 0.05: 6.571, 0.95: 23.685, 0.975: 26.119, 0.99: 29.141, 0.995: 31.319 },
    15: { 0.005: 4.601, 0.01: 5.229, 0.025: 6.262, 0.05: 7.261, 0.95: 24.996, 0.975: 27.488, 0.99: 30.578, 0.995: 32.801 },
    16: { 0.005: 5.142, 0.01: 5.812, 0.025: 6.908, 0.05: 7.962, 0.95: 26.296, 0.975: 28.845, 0.99: 32.000, 0.995: 34.267 },
    17: { 0.005: 5.697, 0.01: 6.408, 0.025: 7.564, 0.05: 8.672, 0.95: 27.587, 0.975: 30.191, 0.99: 33.409, 0.995: 35.718 },
    18: { 0.005: 6.265, 0.01: 7.015, 0.025: 8.231, 0.05: 9.390, 0.95: 28.869, 0.975: 31.526, 0.99: 34.805, 0.995: 37.156 },
    19: { 0.005: 6.844, 0.01: 7.633, 0.025: 8.907, 0.05: 10.117, 0.95: 30.144, 0.975: 32.852, 0.99: 36.191, 0.995: 38.582 },
    20: { 0.005: 7.434, 0.01: 8.260, 0.025: 9.591, 0.05: 10.851, 0.95: 31.410, 0.975: 34.170, 0.99: 37.566, 0.995: 39.997 },
    21: { 0.005: 8.034, 0.01: 8.897, 0.025: 10.283, 0.05: 11.591, 0.95: 32.671, 0.975: 35.479, 0.99: 38.932, 0.995: 41.401 },
    22: { 0.005: 8.643, 0.01: 9.542, 0.025: 10.982, 0.05: 12.338, 0.95: 33.924, 0.975: 36.781, 0.99: 40.289, 0.995: 42.796 },
    23: { 0.005: 9.260, 0.01: 10.196, 0.025: 11.689, 0.05: 13.091, 0.95: 35.172, 0.975: 38.076, 0.99: 41.638, 0.995: 44.181 },
    24: { 0.005: 9.886, 0.01: 10.856, 0.025: 12.401, 0.05: 13.848, 0.95: 36.415, 0.975: 39.364, 0.99: 42.980, 0.995: 45.559 },
    25: { 0.005: 10.520, 0.01: 11.524, 0.025: 13.120, 0.05: 14.611, 0.95: 37.652, 0.975: 40.646, 0.99: 44.314, 0.995: 46.928 },
    26: { 0.005: 11.160, 0.01: 12.198, 0.025: 13.844, 0.05: 15.379, 0.95: 38.885, 0.975: 41.923, 0.99: 45.642, 0.995: 48.290 },
    27: { 0.005: 11.808, 0.01: 12.879, 0.025: 14.573, 0.05: 16.151, 0.95: 40.113, 0.975: 43.195, 0.99: 46.963, 0.995: 49.645 },
    28: { 0.005: 12.461, 0.01: 13.565, 0.025: 15.308, 0.05: 16.928, 0.95: 41.337, 0.975: 44.461, 0.99: 48.278, 0.995: 50.993 },
    29: { 0.005: 13.121, 0.01: 14.256, 0.025: 16.047, 0.05: 17.708, 0.95: 42.557, 0.975: 45.722, 0.99: 49.588, 0.995: 52.336 },
    30: { 0.005: 13.787, 0.01: 14.953, 0.025: 16.791, 0.05: 18.493, 0.95: 43.773, 0.975: 46.979, 0.99: 50.892, 0.995: 53.672 },
    40: { 0.005: 20.707, 0.01: 22.164, 0.025: 24.433, 0.05: 26.509, 0.95: 55.758, 0.975: 59.342, 0.99: 63.691, 0.995: 66.766 },
    50: { 0.005: 27.991, 0.01: 29.707, 0.025: 32.357, 0.05: 34.764, 0.95: 67.505, 0.975: 71.420, 0.99: 76.154, 0.995: 79.490 },
    60: { 0.005: 35.534, 0.01: 37.485, 0.025: 40.482, 0.05: 43.188, 0.95: 79.082, 0.975: 83.298, 0.99: 88.379, 0.995: 91.952 },
    70: { 0.005: 43.275, 0.01: 45.442, 0.025: 48.758, 0.05: 51.739, 0.95: 90.531, 0.975: 95.023, 0.99: 100.425, 0.995: 104.215 },
    80: { 0.005: 51.172, 0.01: 53.540, 0.025: 57.153, 0.05: 60.391, 0.95: 101.879, 0.975: 106.629, 0.99: 112.329, 0.995: 116.321 },
    90: { 0.005: 59.196, 0.01: 61.754, 0.025: 65.647, 0.05: 69.126, 0.95: 113.145, 0.975: 118.136, 0.99: 124.116, 0.995: 128.299 },
    100: { 0.005: 67.328, 0.01: 70.065, 0.025: 74.222, 0.05: 77.929, 0.95: 124.342, 0.975: 129.561, 0.99: 135.807, 0.995: 140.169 }
};

// Función para obtener valor Z
function getZValue(confidenceLevel) {
    const conf = confidenceLevel / 100;
    const alpha = (1 - conf) / 2;
    const upperTail = 1 - alpha;
    return zTable[upperTail] || 1.96;
}

// Función para obtener valor t
function getTValue(df, confidenceLevel) {
    const conf = confidenceLevel / 100;
    const alpha = (1 - conf) / 2;
    const upperTail = 1 - alpha;
    
    // Si los grados de libertad no están en la tabla, usar interpolación o aproximación
    // Si existe entrada exacta para df
    if (df in tTable && tTable[df] && (upperTail in tTable[df])) {
        return tTable[df][upperTail];
    }

    // Para df muy grandes, aproximamos con Z
    const availableDfs = Object.keys(tTable).map(Number).sort((a, b) => a - b);
    const minDf = availableDfs[0];
    const maxDf = availableDfs[availableDfs.length - 1];

    if (df >= maxDf) {
        // usar el último valor disponible (o aproximar con Z)
        const last = tTable[maxDf];
        return (last && last[upperTail]) ? last[upperTail] : getZValue(confidenceLevel);
    }

    if (df <= minDf) {
        const first = tTable[minDf];
        return (first && first[upperTail]) ? first[upperTail] : getZValue(confidenceLevel);
    }

    // Encontrar los df disponibles inmediatamente por debajo y por encima
    let lowerKey = minDf;
    let upperKey = maxDf;
    for (let i = 0; i < availableDfs.length; i++) {
        const k = availableDfs[i];
        if (k <= df) lowerKey = k;
        if (k >= df) { upperKey = k; break; }
    }

    const lowerRow = tTable[lowerKey] || {};
    const upperRow = tTable[upperKey] || {};
    const lowerValue = lowerRow[upperTail] != null ? lowerRow[upperTail] : null;
    const upperValue = upperRow[upperTail] != null ? upperRow[upperTail] : null;

    if (lowerValue == null && upperValue == null) {
        return getZValue(confidenceLevel);
    }
    if (lowerValue == null) return upperValue;
    if (upperValue == null) return lowerValue;

    if (lowerKey === upperKey) return lowerValue;

    // Interpolación lineal entre los dos puntos conocidos
    const fraction = (df - lowerKey) / (upperKey - lowerKey);
    return lowerValue + (upperValue - lowerValue) * fraction;
}

// Función para obtener valor Chi-Cuadrado
function getChiValue(df, probability) {
    if (df in chiTable && probability in chiTable[df]) {
        return chiTable[df][probability];
    }
    
    // Aproximación usando tabla disponible
    const availableDfs = Object.keys(chiTable).map(Number).sort((a, b) => a - b);
    let closestDf = availableDfs.reduce((prev, curr) => 
        Math.abs(curr - df) < Math.abs(prev - df) ? curr : prev
    );
    
    return chiTable[closestDf][probability] || df;
}

// Tabla F simplificada (algunos valores comunes) - [gl1][gl2][alpha]
// Por simplicidad, incluimos algunos valores comunes
const fTableSimple = {
    0.05: {
        10: { 10: 2.98, 15: 2.54, 20: 2.35, 30: 2.16, 60: 1.99, 120: 1.91 },
        15: { 10: 2.54, 15: 2.40, 20: 2.20, 30: 2.01, 60: 1.84, 120: 1.75 },
        20: { 10: 2.35, 15: 2.20, 20: 2.12, 30: 1.93, 60: 1.75, 120: 1.66 },
        30: { 10: 2.16, 15: 2.01, 20: 1.93, 30: 1.84, 60: 1.65, 120: 1.55 }
    },
    0.025: {
        10: { 10: 3.72, 15: 3.06, 20: 2.77, 30: 2.51, 60: 2.27, 120: 2.16 },
        15: { 10: 3.06, 15: 2.86, 20: 2.57, 30: 2.31, 60: 2.06, 120: 1.94 },
        20: { 10: 2.77, 15: 2.57, 20: 2.46, 30: 2.20, 60: 1.95, 120: 1.82 },
        30: { 10: 2.51, 15: 2.31, 20: 2.20, 30: 2.07, 60: 1.82, 120: 1.68 }
    }
};

function getFValue(df1, df2, alpha = 0.05) {
    // Aproximación simple
    return 2.5; // Valor conservador
}
